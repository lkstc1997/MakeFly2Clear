"use strict";!function(){function t(t){for(var o=document.cookie.split("; "),i=0;i<o.length;i++){var e=o[i].split("=");if(e[0]==t)return decodeURIComponent(e[1])}}function o(t){window.csdn&&window.csdn.report&&window.csdn.report.reportClick(t)}function i(t){window.csdn&&window.csdn.report&&window.csdn.report.reportView(t)}function e(){return/(phone|pad|pod|iphone|ipod|ios|ipad|android|mobile|blackberry|iemobile|mqqbrowser|juc|fennec|wosbrowser|browserng|webos|symbian|windows phone|csdn|MicroMessenger)/i.test(navigator.userAgent)}function n(t){this.app=a(),this.isMobile=e(),this.inputData=t,this.defaultParams={domain:"csdn.net",isIframe:!0,frameWidth:this.isMobile?343:410,frameHeight:this.isMobile?368:520,append:"#passportbox",iframeName:"passport_iframe",from:encodeURIComponent(window.location.href),pvSource:"",service:"",loginService:this.isMobile?"https://passport.csdn.net/waplogin":"https://passport.csdn.net/account/login",spm:s.spm?s.spm:""},this.options=Object.assign({},this.defaultParams,this.inputData),this.extend="",this.version="",this.renderCss(),this.fileExtends(),this.init(this.options)}var s={};window.csdn=window.csdn||{};var r=function(t){var o=/([^?#*&=]+)=([^?#*&=]+)/g,i={};return location.href.replace(o,function(){for(var t=arguments.length,o=Array(t),e=0;e<t;e++)o[e]=arguments[e];var n=o[1],s=o[2];i[n]=s}),i[t]},a=function(){return navigator.userAgent.toLowerCase().indexOf("csdn")>-1},p=function(){if(a()){var t=navigator.userAgent.toLowerCase(),o=JSON.stringify({url:"csdnapp://app.csdn.net/login/quick"});/iphone|ipad|ipod|ios/i.test(t)?window.webkit.messageHandlers.csdnjumpnewpage.postMessage(o):window.jsCallBackListener.csdnjumpnewpage(o)}};n.prototype.init=function(t){return this.app?(window.csdn.loginBox.self=void 0,p(),!1):this.isMobile?("auto"!==t.showType?this.wapDistribute(t):this.renderHtml(t),!1):void this.getVersion(t)},n.prototype.fileExtends=function(){for(var t in this.inputData)this.defaultParams.hasOwnProperty(t)||(this.extend=this.extend+"&"+t+"="+this.inputData[t])},n.prototype.renderCss=function(){var t=window.document.head,o=t.firstElementChild||t.firstChild,i=document.createElement("style");i.innerText=".passport-login-container{position: fixed;top: 0;left: 0;z-index: 9999;width: 100%;height: 100%;}.passport-login-box{position: absolute;display: block;border-radius: 8px;left: 50%;top: 50%;z-index: 10001;-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);-o-transform: translate(-50%, -50%);-moz-transform: translate(-50%, -50%);transform: translate(-50%, -50%);background-color: #fff;}.passport-login-mark{position: absolute;top: 0;left: 0;z-index: 9999;background-color: rgba(0, 0, 0, 0.5);width: 100%;height: 100%;}",t.insertBefore(i,o)},n.prototype.renderHtml=function(t){var o=this,e=this.options.loginService;this.$loginDom=$('<div class="passport-login-container"><div id='+this.options.append.replace(/[#\.]/,"")+' class="passport-login-box" style="display: block;'+(this.options.frameHeight?"height:"+this.options.frameHeight+"px":"")+'"></div></div>'),this.$markDom=$('<div class="passport-login-mark"></div>'),window.document.domain=this.options.domain,e=e+(-1===e.indexOf("?")?"?from=":"&from=")+this.options.from,e=this.options.service?e+"&service="+this.options.service:e,e+="&iframe=true",e+="&newframe=true",e=this.options.pvSource?e+"&"+this.options.pvSource:e,e=this.version?e+"&version="+this.version:e,e=this.extend?e+this.extend:e,this.$iframeHtml=$('<iframe  width="'+this.options.frameWidth+'" height="'+this.options.frameHeight+'" name="'+this.options.iframeName+'" src="'+e+'" style="border-radius: 8px;" frameborder="0" scrolling="no"></iframe>'),this.$closeBtn=$('<span style="display: inline-block; color: #999; font-size: 22px; cursor: pointer; position:absolute; top:2%; right:3%;-moz-user-select:none; -webkit-user-select:none; user-select:none;">&times</span>'),this.$closeBtn.on("click",function(){o.close()}),this.$markDom.on("click",function(){o.close()}),this.$loginDom.append(this.$markDom),$("body").append(this.$loginDom),$(this.options.append).append(this.$iframeHtml),$(this.options.append).append(this.$closeBtn);var n={};return n="auto"!==t.showType?{spm:"3001.6428"}:{spm:"3001.6428",extra:JSON.stringify({showType:"auto"})},i(n),!0},n.prototype.close=function(){o({spm:"3001.6428"}),this.$loginDom.remove(),window.csdn.loginBox.self=void 0},n.prototype.getVersion=function(t){var o=this;$.ajax({type:"get",url:"https://passport.csdn.net/v1/register/pc/iframe/login/version",crossDomain:!0,xhrFields:{withCredentials:!0},contentType:"application/json",success:function(i){i.status?(o.options.frameWidth=i.data.width,o.options.frameHeight=i.data.height,o.version=i.data.controlVersion,o.renderHtml(t)):o.renderHtml(t)},error:function(i){o.renderHtml(t)}})},n.prototype.wapDistribute=function(t){var o=this,i={platform:"WAP",source:o.options.pvSource,spm:o.options.spm};$.ajax({type:"get",url:"https://passport.csdn.net/v1/login/distribute/login/route?from="+o.options.from,data:i,crossDomain:!0,xhrFields:{withCredentials:!0},contentType:"application/json",success:function(i){if(i.status){if(!i.data.popup)return window.csdn.loginBox.self=void 0,window.location.href=i.data.routeUrl,!1;o.options.frameWidth=i.data.width,o.options.frameHeight=i.data.height,o.renderHtml(t)}else o.renderHtml(t)},error:function(i){o.renderHtml(t)}})},window.csdn.loginBox={self:void 0,show:function(o){return t("UserName")?void void 0:a()?void new n(o):void(this.self||(this.self=new n(o)))},close:function(){return this.self.close()},loginout:function(t){var o=Object.assign({},t);$.ajax({type:"post",url:"https://passport.csdn.net/account/logout",data:JSON.stringify(o),crossDomain:!0,xhrFields:{withCredentials:!0},success:function(t){},error:function(t){}})},setlogin:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{UserName:void 0,UserToken:void 0},o=t.UserName||r("UserName"),i=t.UserToken||r("UserToken"),e=Object.assign({},{username:o,userToken:i});return new Promise(function(t,o){$.ajax({type:"post",url:"https://passport.csdn.net/v1/login/wap/userToken/refresh",data:JSON.stringify(e),crossDomain:!0,contentType:"application/json",xhrFields:{withCredentials:!0},success:function(o){t(o)},error:function(t){o(t)}})})}},$(document).on("click",".c-login-check",function(o){s=$(this).data("reportClick")||$(this).parent().data("reportClick")||$(this).parent().parent().data("reportClick"),t("UserName")||(o.stopPropagation(),window.csdn.loginBox.show())})}();